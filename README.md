# Лабораторная работа №6 “Моделирование, работа с файлами и интеграция между двумя ЯП”:

### Задание:
Реализовать программу для имитационного моделирования динамики полового и возрастного состава населения России за последние 50 лет. Программа должна удовлетворять требованиям к коду и полностью реализовывать функциональные возможности описанной в задании модели.

### Функциональные требования:
Порядок работы с программой должен выглядеть следующим образом: 
Пользователь в python ноутбуке указывает:
1) путь к файлу с первоначальным возрастным составом населения
2) путь к файлу с таблицей смертности
3) год начала моделирования (по умолчанию - 1970);
4) год окончания моделирования (по умолчанию - 2021);
5) начальная общая численность населения (по умолчанию - 130 млн. чел.).

После чего python ноутбук запускает программу самого имитационного моделирования, написанную на C#, которая и начинает процесс моделирования с заданными параметрами. По окончании процесса, программа должна выдавать один или несколько файлов с результатами. 
После этого - при помощи python ноутбука данные визуализируются. А именно:
1) график изменения общего населения по годам в виде spline chart;
2) график изменения населения мужского пола по годам в виде spline chart;
3) график изменения населения женского пола по годам в виде spline chart;
4) возрастной состав населения мужского пола на конец моделирования для возрастных категорий 0-18, 19-45, 45-65 и 65-100 лет в виде bar chart;
5) возрастной состав населения женского пола на конец моделирования для возрастных категорий 0-18, 19-44, 45-65 и 66-100 лет в виде bar chart.
По желанию графики можно объединять и отображать на одном контрольном элементе. Единицы измерения на графиках должны быть в тыс. чел.

### Требования к архитектуре:
Программа должна быть написана в отдельном солюшене под названием Demographic и состоять минимум из трех проектов:
- Demographic - Class Library (.NET Standard) с основной бизнес логикой: всеми интерфейсами, моделями основных сущностей и движком моделирования;
- Demographic.Exec - Console App (.NET) запускаемое приложение. Не должно содержать бизнес-логики (содержит логику чтения конфигурации из атрибутов командной строки и запускает основной процесс моделирования);
- Demographic.FileOperations - Class Library (.NET Standard) с классами-реализациями интерфейсов по получению данных о первоначальном возрастным составе населения и таблице смертности, а также по записи файлов с результатами.
В проекте Demographic основной движок моделирования должен быть представлен интерфейсом IEngine и его реализацией Engine. Именно он должен содержать коллекцию объектов класса Person, моделирующего отдельного человека. Класс Engine должен содержать событие YearTick, уведомляющее о наступлении нового года, на которое должен быть подписан каждый объект класса Person. В свою очередь, класс Person должен иметь событие ChildBirth, уведомляющее движок о рождении ребенка от данного объекта.
Запуск процессов из Python’а
Для запуска различных процессов из Python’а отвечает модуль subprocess. Рекомендуемый подход к вызову подпроцессов - использование функции run(). Например: subprocess.run([‘my_program.exe’, ‘arg1’, ‘arg2’]). Вызов такой функции приведет к запуску процесса my_program.exe с аргументами командной строки ‘arg1’ и ‘arg2’. Управление питону вернется только после завершение выполнения программы my_program.exe.
То есть мы можем вызвать из питона выполнение нашей программы-движка на C#, дождаться ее выполнения и продолжить работу в питоне уже с готовыми результатами моделирования в заданных файлах.

### Входные файлы:
Первоначальный возрастной состав населения обоих полов, с которого должен начинаться процесс моделирования, представлен в файле InitialAge.csv. Первый столбец указывает на возраст, второй на количество человек соответствующего возраста в расчете на 1000. 
В файле DeathRules.csv представлены правила вычисления вероятности умереть человека каждого пола для определенного возраста, взятые из таблицы смертности. В нем первые два столбца отвечают за возрастной интервал, а третий и четвертый столбец хранят вероятность смерти мужчин и женщин из этих интервалов соответственно за один год из указанного интервала.

### Имитационная модель:
Движок моделирования должен в цикле отсчитывать проходящие года, посылая события всем людям о прошедшем годе. Каждый человек должен реагировать на данное событие обработкой собственных правил существования. Основные правила и концепции:
Один объект человека (класс Person) моделирует 1 тыс. чел. (Если у вас очень слабый компьютер, то можно 1 млн. чел, но результаты могут быть хуже)
Объект класса Person, как минимум, хранит информацию о собственном поле, годе рождения и статусе жизни (жив/мертв). В случае смерти, должна записываться информация о годе смерти.
Каждый объект человека каждый год должен принимать решение о продолжении собственной жизни на основании вероятности умереть для своего пола и возрастной категории из таблицы смертности.
После смерти, человек больше не изменяет свое состояние и не генерирует новых событий.
Если человек жив, женского пола и в возрасте 18-45 лет, то он с вероятностью 0.151 может сгенерировать событие о рождении ребенка.
При рождении ребенка вероятность того, что он девочка - 0.55, и мальчик - 0.45.
В начале моделирования женщин и мужчин должно быть поровну, а их возрастное распределение определяется файлом InitialAge.csv.

### Дополнительные задания:
Можно получить дополнительные баллы за выполнение задания:
1) Модификация начальных условий, данных, констант и правил моделирования для улучшения результатов и максимального приближения их к реальным. Чем лучше будет модель, тем больше баллов можно получить (max 5). За реальные результаты можно взять следующие данные:
2) Общее население в 1970 году: 130 079 210 чел. Источник
3) Общее население в 2021 году: 146 171 015 чел. Источник.
4) Возрастное распределение в 2021 году из источника.
5) Реальные данные можно брать из других источников, главное, чтобы они были согласованными друг с другом и из воспроизводимого источника.

### Определение наступления события по его вероятности:
Определять наступление события по его вероятности можно с помощью приведенного в примере класса:

```
public static class ProbabilityCalculator
{
    	private static readonly Random _random = new Random();

    	public static bool IsEventHappened(double eventProbability)
    	{
        	return _random.NextDouble() <= eventProbability;
    	}
}
```

В данном примере класс статический для того, чтобы каждый раз не создавать заново объект генератора псевдослучайных чисел, что будет экономить ресурсы в программе, где за один процесс моделирования необходимо вызывать генератор несколько миллионов раз. В отсутствии таких ограничений, статическими классами лучше не пользоваться без необходимости.
