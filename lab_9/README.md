# Лабораторные работы по ЯПП на C#

## Лабораторная работа №9 “Базы данных”.

### Теоретическая часть:
Задание на лабораторную работу:
Варианты:
Вариант 1
Вариант 2
Вариант 3
Вариант 4

### Теоретическая часть:

- База Данных (Data Base) — это упорядоченный набор структурированной информации или данных, которые обычно хранятся в электронном виде в компьютерной системе. По характеру хранения информации делятся на реляционные, графовые, документо-ориентированные, колончатые, иерархические, ключ-значение и др.

- Реляционная База Данных - называются базы данных, в основе построения которых лежит реляционная модель. Данные в реляционных структурах организованы в виде набора таблиц, называемых отношениями, состоящих из столбцов и строк. В таблицах хранится информация об объектах, представленных в базе данных. Каждая строка таблицы представляет собой набор связанных значений, относящихся к одному объекту, или сущности. Каждая строка в таблице может быть помечена уникальным идентификатором, называемым первичным ключом, а строки из нескольких таблиц могут быть связаны с помощью внешних ключей.

- СУБД (Система Управления Базой Данных) — комплекс ПО, с помощью которого можно создавать базы данных (БД) и проводить над ними различные операции: обновлять, удалять, выбирать, редактировать и т. д. СУБД гарантирует сохранность, целостность, безопасность хранения данных и позволяет выдавать доступ к администрированию БД.

- SQL (Structured Query Language) — декларативный язык программирования, применяемый для создания, модификации и управления данными в реляционной базе данных, управляемой соответствующей системой управления базами данных. 

- Первичный ключ (Primary Key, PK) — главный идентификатор записи в таблице реляционной БД. Обязан быть уникальным в рамках текущей таблицы. На него часто накладываются индексы для увеличения производительности поиска по нему при чтении.

- Внешний ключ (Foreign Key, FK) — хранение первичного ключа записи из другой таблицы в поле записи текущей таблицы для связывания этих двух записей. С помощью внешних ключей можно создавать отношения между таблицами, из-за чего данные базы и называются реляционными. Иногда может принимать значение NULL, что будет обозначать отсутствие связи между конкретной записью в данной таблице и записями из другой в текущий момент.

- ER-диаграмма (Entity-Relationship. Сущность-Связь) — диаграмма для отображения связи между сущностями в предметной области. Чаще всего записывается в нотации Crow’s foot.

- ORM (Object-Relational Mapping) — технология программирования, суть которой заключается в создании «виртуальной объектной базы данных». Благодаря этой технологии разработчики могут использовать язык программирования, с которым им удобно работать с базой данных, вместо написания операторов SQL или хранимых процедур. Это может значительно ускорить разработку приложений, особенно на начальном этапе. ORM также позволяет переключать приложение между различными реляционными базами данных. Например, приложение может быть переключено с MySQL на PostgreSQL с минимальными изменениями кода.

- Entity Framework Core — популярный ORM-фреймворк для .NET от Microsoft с открытым исходным кодом, позволяющий писать запросы к БД с помощью Linq, и  поддерживающий множество реляционных SQL СУБД: Postgres, MS SQL Server, MySql и т.д.

- Схема базы данных (Database schema) — её структура, описанная на формальном языке, поддерживаемом СУБД. В реляционных базах данных схема определяет таблицы, поля в каждой таблице (обычно с указанием их названия, типа, обязательности), и ограничения целостности (первичный, потенциальные и внешние ключи и другие ограничения). 

- Миграция (Migration) — план перехода базы данных от старой схемы к новой.

#### Хорошие руководства по Entity Framework Core можно найти на официальном сайте и обучающем портале Метанит. 

1) О том, как удобно из кода создавать и инициализировать базу с помощью Entity Framework Core можно прочитать здесь.

2) В задании можно встретить тип данных DateTime, используемый для хранения даты и времени. Примеры работы с ним можно так же найти на Метаните.

### Задание на лабораторную работу:

В новом солюшене создать четыре проекта:
1) Presentation — проект по шаблону Console. В нем должен быть реализован пользовательский интерфейс и работа с фасадом.
2) Core — проект по шаблону Class Library. Должен содержать интерфейсы и реализации фасада и основных классов, работающих  с бизнес логикой.
3) DatabaseModels — проект по шаблону Class Library. Должен содержать модели базы данных.
4) DatabaseContext — проект по шаблону Class Library. Должен содержать контекст базы данных и файлы миграций.

В рамках лабораторной работы необходимо установить на локальный компьютер СУБД Postgres и реализовать программу, создающую и работающую с базой данных в ней. Программа должна иметь консольный пользовательский интерфейс (в проекте Presentation), позволяющий создавать, удалять и редактировать все сущности, хранимые в БД, а также выполнять некоторые аналитические операции. При этом при создании новых записей их первичный ключ (PK) должен создаваться автоматически, а все внешние ключи (FK) не должны принимать значение NULL. Вся работа с Базой Данных должна осуществляться с помощью Entity Framework Core, а запросы быть написанными на языке Linq в делегатной форме. Программа должна реализовывать функционал, описанный в одном соответствующем варианте.

Общие требования к лабораторным работам
1) Следовать принципам KISS, DRY, YAGNI и т.п.
2) Следовать принципам ООП
3) Код приложения должен быть разделен на “слои”/компоненты, как минимум:
компонент логики - отвечает за логику приложения, содержит доменные модели, классы, позволяющие с ними взаимодействовать и реализующие основную задачу, поставленную перед приложением. Должен быть независим от конкретной реализации других компонентов! Не должен содержать логику ввода-вывода.
компоненты ввода/вывода - отвечают за ввод данных пользователем, чтение и запись данных в файл и т. п. не должен содержать логики обработки данных, только чтение, парсинг, форматированный вывод.
4) Приложение должно корректно обрабатывать (выводить понятную пользователю ошибку , а не падать) ошибочный ввод пользователя, ситуации отсутствия необходимого файла, некорректных данных и т.п.

#### Варианты:
Номер варианта Nвар рассчитывается по формуле: 
Nвар = (NЭУ mod 4) + 1 
где NЭУ - номер в группе, взятый из Электронного Университета, а mod - операция взятия остатка от деления. Например, 10 mod 3 =1 , 12 mod 3 =0, 2 mod 5 = 2  и т.д.

#### Вариант 1:
Каждый покупатель (Customer) может иметь произвольное количество заказов (Orders), причем заказ может относиться только к одному покупателю. У каждого заказа есть одна доставка (Shipments), относящаяся только к нему.

Кроме функционала по созданию, редактированию и удалению любых записей всех трех сущностей программа должна по требованию пользователя выполнять следующие запросы и предоставлять результаты:
1) Сколько у покупателя с заданным идентификатором заказов?
2) На какой адрес (Address) должна быть выполнена доставка с заданным идентификатором?
3) На какую сумму (Price) у покупателя с заданным идентификатором заказов всего (сколько в сумме им было потрачено денег)?

#### Вариант 2:
Студент (Student) может состоять только в одной группе (Group), которая может иметь произвольное количество студентов. Каждая группа имеет одного куратора (Curator), который может быть куратором только у одной группы.

Кроме функционала по созданию, редактированию и удалению любых записей всех трех сущностей программа должна по требованию пользователя выполнять следующие запросы и предоставлять результаты:
1) Сколько студентов в группе с заданным идентификатором?
2) Как зовут (Name) куратора группы, в которой состоит студент с заданным идентификатором?
3) Какой средний возраст (Age) у студентов группы, курируемой куратором с заданным идентификатором?

#### Вариант 3:
На выставку (Exhibition) может быть продано произвольное количество билетов (Tickets), дающих право пройти только на данную выставку. Билет продается только одному посетителю (Visitor), но посетитель может купить произвольное количество билетов.

Кроме функционала по созданию, редактированию и удалению любых записей всех трех сущностей программа должна по требованию пользователя выполнять следующие запросы и предоставлять результаты:
1) Сколько билетов продано на выставку с указанным идентификатором?
2) На сколько уникальных выставок сходил посетитель с заданным идентификатором? Если на одну выставку посетителем было куплено более одного билета, она все равно считается одной уникальной. 
3) Какой средний процент скидки (Discount) был у посетителей выставки с заданным идентификатором?

#### Вариант 4:
У каждого врача (Doctor) есть одна специализация (Specialization), причем у разных  врачей специализация может быть одна и та же. Кроме того у каждого врача может быть произвольное количество личных сертификатов (Certificates).

Кроме функционала по созданию, редактированию и удалению любых записей всех трех сущностей программа должна по требованию пользователя выполнять следующие запросы и предоставлять результаты:
1) Сколько всего врачей обладают специализацией с заданным идентификатором?
2) Как называется специализация (Name), по которой выдан сертификат с заданным идентификатором?
3) Когда был выдан (Date) хронологически последний сертификат для врача с заданным идентификатором?

